function updateAddressesDisplay(e){updateAddressDisplay("delivery");var d="";try{var s=getAddressesTitles();d=s.invoice}catch(a){}return 1===$("#addressesAreEquals:checked").length&&0===$("#multishipping_mode_checkbox:checked").length?(0===$("#multishipping_mode_checkbox:checked").length&&$("#address_invoice_form:visible").hide("fast"),$("ul#address_invoice").html($("ul#address_delivery").html()),$("ul#address_invoice li.address_title").html(d)):($("#address_invoice_form:hidden").show("fast"),$("#id_address_invoice").val()?updateAddressDisplay("invoice"):($("ul#address_invoice").html($("ul#address_delivery").html()),$("ul#address_invoice li.address_title").html(d))),e||"order"===orderProcess&&updateAddresses(),!0}function updateAddressDisplay(e){if(!("undefined"==typeof formatedAddressFieldsValuesList||formatedAddressFieldsValuesList.length<=0)){var d=parseInt($("#id_address_"+e).val());buildAddressBlock(d,e,$("#address_"+e));var s=$("ul#address_"+e+" li.address_update a").attr("href"),a=/id_address=\d+/;s&&(s=s.replace(a,"id_address="+d),$("ul#address_"+e+" li.address_update a").attr("href",s))}}function updateAddresses(){var e=parseInt($("#id_address_delivery").val()),d=1===$("#addressesAreEquals:checked").length?e:parseInt($("#id_address_invoice").val());0==isNaN(e)&&0==isNaN(d)&&($(".addresses .waitimage").show(),$('.button[name="processAddress"]').prop("disabled","disabled"),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:baseUri+"?rand="+(new Date).getTime(),async:!0,cache:!1,dataType:"json",data:{processAddress:!0,step:2,ajax:"true",controller:"order","multi-shipping":$("#id_address_delivery:hidden").length,id_address_delivery:e,id_address_invoice:d,token:static_token},success:function(e){if(e.hasError){var d="";for(var s in e.errors)"indexOf"!==s&&(d+=$("<div />").html(e.errors[s]).text()+"\n");$.prototype.fancybox?$.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+d+"</p>"}],{padding:0}):alert(d)}$(".addresses .waitimage").hide(),$('.button[name="processAddress"]').prop("disabled","")},error:function(e,d,s){$(".addresses .waitimage").hide(),$('.button[name="processAddress"]').prop("disabled",""),"abort"!==d&&(error="TECHNICAL ERROR: unable to save adresses \n\nDetails:\nError thrown: "+e+"\nText status: "+d,$.prototype.fancybox?$.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+error+"</p>"}],{padding:0}):alert(error))}}))}function getAddressesTitles(){return"undefined"!=typeof titleInvoice&&"undefined"!=typeof titleDelivery?{invoice:titleInvoice,delivery:titleDelivery}:{invoice:"",delivery:""}}function buildAddressBlock(e,d,s){if(!isNaN(e)){var a=getAddressesTitles(),r=formatedAddressFieldsValuesList[e].formated_fields_values,i=["title"],t=new RegExp("[ ]+","g");if(i=i.concat(formatedAddressFieldsValuesList[e].ordered_fields),i=i.concat(["update"]),s.html(""),r.title=a[d],"undefined"!=typeof liUpdate){var n=(liUpdate.split(t),new RegExp('(https?://[^"]*)',"gi"));liUpdate=liUpdate.replace(n,addressUrlAdd+parseInt(e)),r.update=liUpdate}appendAddressList(s,r,i)}}function appendAddressList(e,d,s){for(var a in s){var r=s[a].replace(",",""),i=getFieldValue(r,d);if(""!=i){var t=document.createElement("li"),n=new RegExp("[ ]+","g"),l=r.split(n);t.className="";for(clas in l)t.className+="address_"+l[clas].toLowerCase().replace(":","_")+" ";t.className=t.className.trim(),t.innerHTML=i,e.append(t)}}}function getFieldValue(e,d){var s=new RegExp("[ ]+","g"),a=e.split(s),r=new Array;for(var i in a)a[i]=a[i].replace(",",""),r.push(d[a[i]]);return r.join(" ")}$(document).ready(function(){"undefined"!=typeof formatedAddressFieldsValuesList&&updateAddressesDisplay(!0),$(document).on("change","select[name=id_address_delivery], select[name=id_address_invoice]",function(){updateAddressesDisplay(),"undefined"!=typeof opc&&opc&&updateAddressSelection()}),$(document).on("click","input[name=same]",function(){updateAddressesDisplay(),"undefined"!=typeof opc&&opc&&updateAddressSelection()})});