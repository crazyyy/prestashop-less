function arrayUnique(i){return i.reduce(function(i,t){return i.indexOf(t)<0&&i.push(t),i},[])}function function_exists(i){return"string"==typeof i?"function"==typeof window[i]:i instanceof Function}function oosHookJsCode(){for(var i=0;i<oosHookJsCodeFunctions.length;i++)function_exists(oosHookJsCodeFunctions[i])&&setTimeout(oosHookJsCodeFunctions[i]+"()",0)}function addCombination(i,t,e,a,n,o,c,r,s,l,u){globalQuantity+=e;var d=[];d.idCombination=i,d.quantity=e,d.idsAttributes=t,d.price=a,d.ecotax=n,d.image=o,d.reference=c,d.unit_price=r,d.minimal_quantity=s,d.available_date=[],d.available_date=l,d.specific_price=[],d.specific_price=u,combinations.push(d)}function findCombination(i){$("#minimal_quantity_wanted_p").fadeOut(),("undefined"==typeof $("#minimal_quantity_label").text()||$("#minimal_quantity_label").html()>1)&&$("#quantity_wanted").val(1);var t=[],e=parseInt($("#attributes .checked > input[type=radio]").length);e=e?"#attributes .checked > input[type=radio]":"#attributes input[type=radio]:checked",$("#attributes select, #attributes input[type=hidden], "+e).each(function(){t.push(parseInt($(this).val()))}),"undefined"!=typeof combinations&&combinations||(combinations=[]);for(var a=0;a<combinations.length;++a){var n=!0;if($.each(combinations[a].idsAttributes,function(i,e){in_array(parseInt(e),t)||(n=!1)}),n)return combinations[a].minimal_quantity>1&&($("#minimal_quantity_label").html(combinations[a].minimal_quantity),$("#minimal_quantity_wanted_p").fadeIn(),$("#quantity_wanted").val(combinations[a].minimal_quantity),$("#quantity_wanted").bind("keyup",function(){checkMinimalQuantity(combinations[a].minimal_quantity)})),selectedCombination.unavailable=!1,selectedCombination.reference=combinations[a].reference,$("#idCombination").val(combinations[a].idCombination),quantityAvailable=combinations[a].quantity,selectedCombination.price=combinations[a].price,selectedCombination.unit_price=combinations[a].unit_price,selectedCombination.specific_price=combinations[a].specific_price,combinations[a].ecotax?selectedCombination.ecotax=combinations[a].ecotax:selectedCombination.ecotax=default_eco_tax,combinations[a].image&&-1!=combinations[a].image&&displayImage($("#thumb_"+combinations[a].image).parent()),combinations[a].idCombination&&combinations[a].idCombination>0&&displayDiscounts(combinations[a].idCombination),selectedCombination.available_date=combinations[a].available_date,updateDisplay(),void refreshProductImages("undefined"!=typeof i&&i?0:combinations[a].idCombination)}selectedCombination.unavailable=!0,"undefined"!=typeof selectedCombination.available_date&&delete selectedCombination.available_date,updateDisplay()}function updateDisplay(){productPrice,productPriceWithoutReduction;if(!selectedCombination.unavailable&&quantityAvailable>0&&1==productAvailableForOrder)$("#quantity_wanted_p:hidden").show("slow"),$("#add_to_cart:hidden").fadeIn(600),$("#oosHook").hide(),$("#availability_date").fadeOut(),""!=availableNowValue?($("#availability_value").removeClass("warning_inline"),$("#availability_value").text(availableNowValue),1==stock_management&&$("#availability_statut:hidden").show()):$("#availability_statut:visible").hide(),allowBuyWhenOutOfStock||(quantityAvailable<=maxQuantityToAllowDisplayOfLastQuantityMessage?$("#last_quantities").show("slow"):$("#last_quantities").hide("slow")),quantitiesDisplayAllowed&&($("#pQuantityAvailable:hidden").show("slow"),$("#quantityAvailable").text(quantityAvailable),quantityAvailable<2?($("#quantityAvailableTxt").show(),$("#quantityAvailableTxtMultiple").hide()):($("#quantityAvailableTxt").hide(),$("#quantityAvailableTxtMultiple").show()));else{if(1==productAvailableForOrder&&($("#oosHook").show(),$("#oosHook").length>0&&function_exists("oosHookJsCode")&&oosHookJsCode()),$("#last_quantities:visible").hide("slow"),$("#pQuantityAvailable:visible").hide("slow"),allowBuyWhenOutOfStock||$("#quantity_wanted_p:visible").hide("slow"),selectedCombination.unavailable?($("#availability_value").text(doesntExist).addClass("warning_inline"),$("#oosHook").hide()):($("#availability_value").text(doesntExistNoMore+(globalQuantity>0?" "+doesntExistNoMoreBut:"")),allowBuyWhenOutOfStock||$("#availability_value").addClass("warning_inline")),1!=stock_management||allowBuyWhenOutOfStock||$("#availability_statut:hidden").show(),"undefined"!=typeof selectedCombination.available_date&&0!=selectedCombination.available_date.date.length){var i=selectedCombination.available_date.date,t=i.split("-"),e=new Date(t[0],t[1],t[2]);e.setMonth(e.getMonth()-1);var a=new Date;a.getTime()<e.getTime()&&$("#availability_date_value").text()!=selectedCombination.available_date.date_formatted?$("#availability_date").fadeOut("normal",function(){$("#availability_date_value").text(selectedCombination.available_date.date_formatted),$(this).fadeIn()}):a.getTime()<e.getTime()&&$("#availability_date").fadeIn()}else $("#availability_date").fadeOut();allowBuyWhenOutOfStock&&!selectedCombination.unavailable&&1==productAvailableForOrder?($("#add_to_cart:hidden").fadeIn(600),""!=availableLaterValue?($("#availability_value").text(availableLaterValue),1==stock_management&&$("#availability_statut:hidden").show("slow")):$("#availability_statut:visible").hide("slow")):($("#add_to_cart:visible").fadeOut(600),1==stock_management&&$("#availability_statut:hidden").show("slow")),0==productAvailableForOrder&&$("#availability_statut:visible").hide()}selectedCombination.reference||productReference?(selectedCombination.reference?$("#product_reference span").text(selectedCombination.reference):productReference&&$("#product_reference span").text(productReference),$("#product_reference:hidden").show("slow")):$("#product_reference:visible").hide("slow"),productHasAttributes&&updatePrice()}function updatePrice(){if(combID=$("#idCombination").val(),combination=combinationsFromController[combID],"undefined"!=typeof combination){var i=productBasePriceTaxExcl,t=0;i+=combination.price,combination.specific_price&&combination.specific_price.price>0&&(i=combination.specific_price.price),t=i*(1-group_reduction);var e=t;if(noTaxForThisProduct||customerGroupWithoutTax?(basePriceDisplay=i,priceWithDiscountsDisplay=e):(basePriceDisplay=i*(taxRate/100+1),priceWithDiscountsDisplay=e*(taxRate/100+1)),default_eco_tax&&(basePriceDisplay+=default_eco_tax*(1+ecotaxTax_rate/100),priceWithDiscountsDisplay+=default_eco_tax*(1+ecotaxTax_rate/100)),combination.specific_price&&combination.specific_price.reduction>0&&("amount"==combination.specific_price.reduction_type?(priceWithDiscountsDisplay-=combination.specific_price.reduction,e=priceWithDiscountsDisplay*(1/(1+taxRate)/100)):"percentage"==combination.specific_price.reduction_type&&(priceWithDiscountsDisplay*=1-combination.specific_price.reduction,e=priceWithDiscountsDisplay*(1/(1+taxRate)/100))),basePriceDisplay!=priceWithDiscountsDisplay)var a=basePriceDisplay-priceWithDiscountsDisplay,n=100*(1-priceWithDiscountsDisplay/basePriceDisplay);$("#reduction_percent").hide(),$("#reduction_amount").hide(),$("#old_price,#old_price_display,#old_price_display_taxes").hide(),$(".price-ecotax").hide(),$(".unit-price").hide(),$("#our_price_display").text(formatCurrency(priceWithDiscountsDisplay*currencyRate,currencyFormat,currencySign,currencyBlank)),priceWithDiscountsDisplay.toFixed(2)!=basePriceDisplay.toFixed(2)&&($("#old_price_display").text(formatCurrency(basePriceDisplay*currencyRate,currencyFormat,currencySign,currencyBlank)),$("#old_price,#old_price_display,#old_price_display_taxes").show(),e!=t&&("amount"==combination.specific_price.reduction_type?($("#reduction_amount_display").html("-"+formatCurrency(parseFloat(a),currencyFormat,currencySign,currencyBlank)),$("#reduction_amount").show()):($("#reduction_percent_display").html("-"+parseFloat(n).toFixed(0)+"%"),$("#reduction_percent").show()))),default_eco_tax&&(ecotax=default_eco_tax,combination.ecotax&&(ecotax=combination.ecotax),noTaxForThisProduct||(ecotax*=1+ecotaxTax_rate/100),$("#ecotax_price_display").text(formatCurrency(ecotax*currencyRate,currencyFormat,currencySign,currencyBlank)),$(".price-ecotax").show()),productUnitPriceRatio>0&&(unit_price=priceWithDiscountsDisplay/productUnitPriceRatio,$("#unit_price_display").text(formatCurrency(unit_price*currencyRate,currencyFormat,currencySign,currencyBlank)),$(".unit-price").show()),updateDiscountTable(priceWithDiscountsDisplay)}}function displayImage(i,t){if("undefined"==typeof t&&(t=!1),i.prop("href")){var e=i.attr("href").replace("thickbox","large"),a=i.attr("title"),n=i.attr("href");$("#bigpic").prop("src")!=e&&$("#bigpic").attr({src:e,alt:a,title:a}).load(function(){"undefined"!=typeof jqZoomEnabled&&jqZoomEnabled&&$(this).attr("rel",n)}),$("#views_block li a").removeClass("shown"),$(i).addClass("shown")}}function displayDiscounts(i){$("#quantityDiscount tbody tr").each(function(){"quantityDiscount_0"!=$(this).attr("id")&&$(this).attr("id")!="quantityDiscount_"+i&&"noQuantityDiscount"!=$(this).attr("id")&&$(this).fadeOut("slow")}),0!=$("#quantityDiscount_"+i+",.quantityDiscount_"+i).length||0!=$("#quantityDiscount_0,.quantityDiscount_0").length?($("#quantityDiscount").parent().show(),$("#quantityDiscount_"+i+",.quantityDiscount_"+i).show(),$("#noQuantityDiscount").hide()):($("#quantityDiscount").parent().hide(),$("#noQuantityDiscount").show())}function updateDiscountTable(i){$("#quantityDiscount tbody tr").each(function(){var t=$(this).data("discount-type"),e=$(this).data("discount"),a=$(this).data("discount-quantity");if("percentage"==t)var n=i*(1-e/100),o=i*(e/100)*a;else if("amount"==t)var n=i-e,o=e*a;0!=displayDiscountPrice&&$(this).children("td").eq(1).text(formatCurrency(n,currencyFormat,currencySign,currencyBlank)),$(this).children("td").eq(2).text(upToTxt+" "+formatCurrency(o,currencyFormat,currencySign,currencyBlank))})}function serialScrollFixLock(i,t,e,a,n){serialScrollNbImages=$("#thumbs_list li:visible").length,serialScrollNbImagesDisplayed=3;var o=0==n?!0:!1,c=n+serialScrollNbImagesDisplayed>=serialScrollNbImages?!0:!1;return $("#view_scroll_left").css("cursor",o?"default":"pointer").css("display",o?"none":"block").fadeTo(0,o?0:1),$("#view_scroll_right").css("cursor",c?"default":"pointer").fadeTo(0,c?0:1).css("display",c?"none":"block"),!0}function refreshProductImages(i){if($("#thumbs_list_frame").scrollTo("li:eq(0)",700,{axis:"x"}),i=parseInt(i),i>0&&"undefined"!=typeof combinationImages&&"undefined"!=typeof combinationImages[i]){$("#thumbs_list li").hide(),$("#thumbs_list").trigger("goto",0);for(var t=0;t<combinationImages[i].length;t++)"undefined"!=typeof jqZoomEnabled&&jqZoomEnabled?$("#thumbnail_"+parseInt(combinationImages[i][t])).show().children("a.shown").trigger("click"):$("#thumbnail_"+parseInt(combinationImages[i][t])).show()}else $("#thumbs_list li").show();parseInt($("#thumbs_list_frame >li:visible").length)!=parseInt($("#thumbs_list_frame >li").length)?$("#wrapResetImages").stop(!0,!0).show():$("#wrapResetImages").stop(!0,!0).hide();var e=$("#thumbs_list_frame >li").outerWidth()+parseInt($("#thumbs_list_frame >li").css("marginRight"));$("#thumbs_list_frame").width(parseInt(e*$("#thumbs_list_frame >li").length)+"px"),$("#thumbs_list").trigger("goto",0),serialScrollFixLock("","","","",0)}function saveCustomization(){$("#quantityBackup").val($("#quantity_wanted").val()),customAction=$("#customizationForm").attr("action"),$('body select[id^="group_"]').each(function(){customAction=customAction.replace(new RegExp(this.id+"=\\d+"),this.id+"="+this.value)}),$("#customizationForm").attr("action",customAction),$("#customizationForm").submit()}function submitPublishProduct(i,t,e){var a=$("#admin-action-product-id").val();return $.ajaxSetup({async:!1}),$.post(i+"/index.php",{action:"publishProduct",id_product:a,status:1,redirect:t,ajax:1,tab:"AdminProducts",token:e},function(i){-1===i.indexOf("error")&&(document.location.href=i)}),!0}function checkMinimalQuantity(i){$("#quantity_wanted").val()<i?($("#quantity_wanted").css("border","1px solid red"),$("#minimal_quantity_wanted_p").css("color","red")):($("#quantity_wanted").css("border","1px solid #BDC2C9"),$("#minimal_quantity_wanted_p").css("color","#374853"))}function colorPickerClick(i){id_attribute=$(i).attr("id").replace("color_",""),$(i).parent().parent().children().removeClass("selected"),$(i).fadeTo("fast",1,function(){$(this).fadeTo("fast",0,function(){$(this).fadeTo("fast",1,function(){$(this).parent().addClass("selected")})})}),$(i).parent().parent().parent().children(".color_pick_hidden").val(id_attribute),findCombination(!1)}function getProductAttribute(){product_attribute_id=$("#idCombination").val(),product_id=$("#product_page_product_id").val(),request="";var i=[],t=parseInt($("#attributes .checked > input[type=radio]").length);t=t?"#attributes .checked > input[type=radio]":"#attributes input[type=radio]:checked",$("#attributes select, #attributes input[type=hidden], "+t).each(function(){i.push($(this).val())});for(var e in attributesCombinations)for(var a in i)attributesCombinations[e].id_attribute===i[a]&&(request+="/"+attributesCombinations[e].group+attribute_anchor_separator+attributesCombinations[e].attribute);request=request.replace(request.substring(0,1),"#/"),url=window.location+"",-1!=url.indexOf("#")&&(url=url.substring(0,url.indexOf("#"))),$("#customizationForm").attr("action",$("#customizationForm").attr("action")+request),window.location=url+request}function initLocationChange(i){i||(i=500),setInterval(checkUrl,i)}function checkUrl(){if((original_url!=window.location||first_url_check)&&(first_url_check=!1,url=window.location+"",-1!=url.indexOf("#/"))){params=url.substring(url.indexOf("#")+1,url.length),tabParams=params.split("/"),tabValues=[],""==tabParams[0]&&tabParams.shift();for(var i in tabParams)tabValues.push(tabParams[i].split(attribute_anchor_separator));product_id=$("#product_page_product_id").val(),$(".color_pick").removeClass("selected"),$(".color_pick").parent().parent().children().removeClass("selected"),count=0;for(var t in tabValues)for(var e in attributesCombinations)attributesCombinations[e].group===decodeURIComponent(tabValues[t][0])&&attributesCombinations[e].attribute===decodeURIComponent(tabValues[t][1])&&(count++,$("#color_"+attributesCombinations[e].id_attribute).addClass("selected"),$("#color_"+attributesCombinations[e].id_attribute).parent().addClass("selected"),$("input:radio[value="+attributesCombinations[e].id_attribute+"]").attr("checked",!0),$("input[type=hidden][name=group_"+attributesCombinations[e].id_attribute_group+"]").val(attributesCombinations[e].id_attribute),$("select[name=group_"+attributesCombinations[e].id_attribute_group+"]").val(attributesCombinations[e].id_attribute));if(count>=0)return findCombination(!1),original_url=url,!0;window.location=url.substring(0,url.indexOf("#"))}return!1}var selectedCombination=[],globalQuantity=0,colors=[];$(document).ready(function(){if("undefined"!=typeof customizationFields&&customizationFields){var i=customizationFields;customizationFields=[];for(var t=0,e=0;e<i.length;++e){var a="pictures_"+parseInt(id_product)+"_"+parseInt(i[e].id_customization_field);customizationFields[e]=[],customizationFields[e][0]=0==parseInt(i[e].type)?"img"+e:"textField"+t++,customizationFields[e][1]=0==parseInt(i[e].type)&&i[e][a]?2:parseInt(i[e].required)}}if("undefined"!=typeof combinationImages&&combinationImages){combinationImagesJS=[],combinationImagesJS[0]=[];var n=0;for(var e in combinationImages){combinationImagesJS[e]=[];for(var t in combinationImages[e]){var o=parseInt(combinationImages[e][t].id_image);o&&(combinationImagesJS[0][n++]=o,combinationImagesJS[e][t]=[],combinationImagesJS[e][t]=o)}}if("undefined"!=typeof combinationImagesJS[0]&&combinationImagesJS[0]){var c=[];for(var a in arrayUnique(combinationImagesJS[0]))c.push(combinationImagesJS[0][a]);combinationImagesJS[0]=c}combinationImages=combinationImagesJS}if("undefined"!=typeof combinations&&combinations){combinationsJS=[];var n=0;for(var e in combinations)globalQuantity+=combinations[e].quantity,combinationsJS[n]=[],combinationsJS[n].idCombination=parseInt(e),combinationsJS[n].idsAttributes=combinations[e].attributes,combinationsJS[n].quantity=combinations[e].quantity,combinationsJS[n].price=combinations[e].price,combinationsJS[n].ecotax=combinations[e].ecotax,combinationsJS[n].image=parseInt(combinations[e].id_image),combinationsJS[n].reference=combinations[e].reference,combinationsJS[n].unit_price=combinations[e].unit_impact,combinationsJS[n].minimal_quantity=parseInt(combinations[e].minimal_quantity),combinationsJS[n].available_date=[],combinationsJS[n].available_date.date=combinations[e].available_date,combinationsJS[n].available_date.date_formatted=combinations[e].date_formatted,combinationsJS[n].specific_price=[],combinationsJS[n].specific_price.reduction_percent=combinations[e].specific_price&&combinations[e].specific_price.reduction&&"percentage"==combinations[e].specific_price.reduction_type?100*combinations[e].specific_price.reduction:0,combinationsJS[n].specific_price.reduction_price=combinations[e].specific_price&&combinations[e].specific_price.reduction&&"amount"==combinations[e].specific_price.reduction_type?combinations[e].specific_price.reduction:0,combinationsJS[n].price=combinations[e].specific_price&&combinations[e].specific_price.price&&-1!=parseInt(combinations[e].specific_price.price)?combinations[e].specific_price.price:combinations[e].price,combinationsJS[n].reduction_type=combinations[e].specific_price&&combinations[e].specific_price.reduction_type?combinations[e].specific_price.reduction_type:"",combinationsJS[n].id_product_attribute=combinations[e].specific_price&&combinations[e].specific_price.id_product_attribute?combinations[e].specific_price.id_product_attribute:0,n++;combinations=combinationsJS}$("#thumbs_list").serialScroll({items:"li:visible",prev:"#view_scroll_left",next:"#view_scroll_right",axis:"x",offset:0,start:0,stop:!0,onBefore:serialScrollFixLock,duration:700,step:2,lazy:!0,lock:!1,force:!1,cycle:!1}),$("#thumbs_list").trigger("goto",1),$("#thumbs_list").trigger("goto",0),$("#views_block li a").hover(function(){displayImage($(this))},function(){}),"undefined"!=typeof jqZoomEnabled&&jqZoomEnabled&&$(".jqzoom").jqzoom({zoomType:"innerzoom",zoomWidth:458,zoomHeight:458,xOffset:21,yOffset:0,title:!1}),$(document).on("click","#view_full_size, #image-block",function(i){$("#views_block .shown").click()}),$(document).on("click","#short_description_block .button",function(i){$("#more_info_tab_more_info").click(),$.scrollTo("#more_info_tabs",1200)}),$(document).on("click","#customizedDatas input",function(i){$("#customizedDatas input").hide(),$("#ajax-loader").fadeIn(),$("#customizedDatas").append(uploading_in_progress)}),original_url=window.location+"",first_url_check=!0;var r=checkUrl();initLocationChange(),"undefined"!=typeof productHasAttributes&&productHasAttributes&&!r?findCombination(!0):"undefined"==typeof productHasAttributes||productHasAttributes||r||refreshProductImages(0),$(document).on("click","a[name=resetImages]",function(i){i.preventDefault(),refreshProductImages(0)}),$(document).on("click",".color_pick",function(i){i.preventDefault(),colorPickerClick($(this)),getProductAttribute()}),$(document).on("change",".attribute_select",function(i){i.preventDefault(),findCombination(),getProductAttribute()}),$(document).on("click",".attribute_radio",function(i){i.preventDefault(),findCombination(),getProductAttribute()}),$(document).on("click","button[name=saveCustomization]",function(i){saveCustomization()}),0==contentOnly?$.prototype.fancybox&&$("li:visible .fancybox, .fancybox.shown").fancybox({hideOnContentClick:!0,openEffect:"elastic",closeEffect:"elastic"}):($(document).on("click",".fancybox",function(i){i.preventDefault()}),$(document).on("click","#image-block",function(i){i.preventDefault();var t=window.document.location.href+"",e=t.replace("content_only=1","");window.parent.document.location.href=e}),"undefined"==typeof ajax_allowed||ajax_allowed||$("#buy_block").attr("target","_top")),$.prototype.bxSlider&&$("#bxslider").bxSlider({minSlides:1,maxSlides:6,slideWidth:178,slideMargin:20,pager:!1,nextText:"",prevText:"",moveSlides:1,infiniteLoop:!1,hideControlOnEnd:!0}),$(document).on("click",".product_quantity_up",function(i){i.preventDefault(),fieldName=$(this).data("field-qty");var t=parseInt($("input[name="+fieldName+"]").val());quantityAvailable>0?quantityAvailableT=quantityAvailable:quantityAvailableT=1e8,!isNaN(t)&&t<quantityAvailableT?$("input[name="+fieldName+"]").val(t+1).trigger("keyup"):$("input[name="+fieldName+"]").val(quantityAvailableT)}),$(document).on("click",".product_quantity_down",function(i){i.preventDefault(),fieldName=$(this).data("field-qty");var t=parseInt($("input[name="+fieldName+"]").val());!isNaN(t)&&t>1?$("input[name="+fieldName+"]").val(t-1).trigger("keyup"):$("input[name="+fieldName+"]").val(1)}),"undefined"!=typeof minimalQuantity&&minimalQuantity&&(checkMinimalQuantity(),$(document).on("keyup","input[name=qty]",function(i){checkMinimalQuantity(minimalQuantity)})),"undefined"!=typeof ad&&ad&&"undefined"!=typeof adtoken&&adtoken&&($(document).on("click","input[name=publish_button]",function(i){i.preventDefault(),submitPublishProduct(ad,0,adtoken)}),$(document).on("click","input[name=lnk_view]",function(i){i.preventDefault(),submitPublishProduct(ad,1,adtoken)})),"undefined"!=typeof product_fileDefaultHtml&&($.uniform.defaults.fileDefaultHtml=product_fileDefaultHtml),"undefined"!=typeof product_fileButtonHtml&&($.uniform.defaults.fileButtonHtml=product_fileButtonHtml)});